const handleGenerateSimplePdf = () => {
                if (!activeClass) return;
                setIsGeneratingPdf(true);

                const students = activeClass.students;
                const studentsPerPage = 28; // Bir A4 sayfasına sığacak yaklaşık öğrenci sayısı
                const numPages = Math.ceil(students.length / studentsPerPage);

                const reportContainer = document.createElement('div');
                reportContainer.style.position = 'absolute';
                reportContainer.style.left = '-9999px';
                reportContainer.style.width = '210mm';
                reportContainer.style.backgroundColor = 'white';
                reportContainer.style.fontFamily = 'sans-serif';
                reportContainer.style.color = 'black';

                let htmlContent = '';

                for (let i = 0; i < numPages; i++) {
                    const studentChunk = students.slice(i * studentsPerPage, (i + 1) * studentsPerPage);
                    
                    const studentRows = studentChunk.map((student, index) => {
                        const globalIndex = i * studentsPerPage + index + 1;
                        return `<tr>
                            <td style="border: 1px solid #eee; padding: 8px;">${globalIndex}</td>
                            <td style="border: 1px solid #eee; padding: 8px;">${student.name}</td>
                            <td style="border: 1px solid #eee; text-align: center; padding: 8px; font-weight: bold; font-size: 14px;">${calculateGrade(student)}</td>
                        </tr>`;
                    }).join('');

                    htmlContent += `
                        <div class="pdf-page-break" style="display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; width: 210mm; height: 297mm; padding: 20mm; ${i > 0 ? '' : 'page-break-after: auto;'}">
                            <div>
                                <div style="text-align: center;">
                                    <h1 style="font-size: 24px;">${settings.schoolName || 'OKUL ADI'}</h1>
                                    <h2 style="font-size: 18px;">${activeClass.name} Sınıfı Performans Raporu (Sayfa ${i + 1}/${numPages})</h2>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 20px;">
                          E-posta         <thead>
                                    <tr style="border-bottom: 2px solid #333;">
                                        <th style="text-align: left; padding: 8px;">No.</th>
                                        <th style="text-align: left; padding: 8px;">Öğrenci Adı</th>
                                        <th style="text-align: center; padding: 8px;">Sözlü Notu</th>
                                    </tr>
                                </thead>
                                <tbody>${studentRows}</tbody>
                            </table>
                            </div>
                            <div style="text-align: right; font-size: 12px; margin-top: 20mm;">
                                <p style="font-weight: bold;">${settings.teacherName || 'Öğretmen Adı'}</p>
                                <p>${settings.branchName || 'Branş'}</p>
                            </div>
                      </div>`;
                }
                
                reportContainer.innerHTML = htmlContent;
                document.body.appendChild(reportContainer);

                const pages = Array.from(reportContainer.children);
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

                const processPage = (index) => {
                    if (index >= pages.length) {
                        pdf.save(`${activeClass.name} - Basit Rapor.pdf`);
                        document.body.removeChild(reportContainer);
                        setIsGeneratingPdf(false);
                        return;
                    }
                    window.html2canvas(pages[index], { scale: 2, useCORS: true }).then(pageCanvas => {
                        if (index > 0) pdf.addPage();
                        const imgData = pageCanvas.toDataURL('image/png');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
                        processPage(index + 1);
                    }).catch(err => {
                         console.error("PDF Sayfa oluşturma hatası:", err);
                         document.body.removeChild(reportContainer);
                         setIsGeneratingPdf(false);
                    });
                };
                processPage(0);
            };
            
            const handleGenerateDetailedPdf = () => {
                if (!activeClass) return;
                setIsGeneratingPdf(true);
                const reportContainer = document.createElement('div'); reportContainer.style.position = 'absolute'; reportContainer.style.left = '-9999px'; reportContainer.style.width = '210mm'; reportContainer.style.backgroundColor = 'white'; reportContainer.style.fontFamily = 'sans-serif'; reportContainer.style.color = 'black';
                let htmlContent = `<div style="padding: 20mm; box-sizing: border-box; width: 210mm; height: 297mm;"><div style="text-align: center; margin-bottom: 10mm;"><h1 style="font-size: 18px; font-weight: bold; margin: 0;">${settings.schoolName || 'OKUL ADI'}</h1><h2 style="font-size: 16px; margin: 5px 0;">${activeClass.name} Sınıfı Performans Raporu</h2><p style="font-size: 12px;">${settings.teacherName || 'Öğretmen'} - ${settings.branchName || 'Branş'}</p></div><h3 style="font-size: 14px; font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 2mm; margin-bottom: 5mm;">Genel Not Özeti</h3><table style="width: 100%; border-collapse: collapse; font-size: 10px;"><thead><tr style="background-color: #f2f2f2;"><th style="border: 1px solid #ddd; padding: 8px; text-align: left;">No.</th><th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Öğrenci Adı</th><th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Sözlü Notu</th></tr></thead><tbody>${activeClass.students.map((student, index) => `<tr><td style="border: 1px solid #ddd; padding: 8px;">${index + 1}</td><td style="border: 1px solid #ddd; padding: 8px;">${student.name}</td><td style="border: 1px solid #ddd; padding: 8px; text-align: center; font-weight: bold;">${calculateGrade(student)}</td></tr>`).join('')}</tbody></table></div>`;
                activeClass.students.forEach(student => { const inClassPoints = (student.scores.inClassPlus * settings.inClassPlus) + (student.scores.inClassMinus * settings.inClassMinus); const homeworkPoints = (student.scores.homeworkPlus * settings.homeworkPlus) + (student.scores.homeworkMinus * settings.homeworkMinus); const dersIciRaporNotu = Math.round(Math.max(0, Math.min(100, settings.baseScore + (inClassPoints * 2)))); const performansOdeviRaporNotu = Math.round(Math.max(0, Math.min(100, settings.baseScore + (homeworkPoints * 2)))); const distributedInClass = distributeScores(dersIciRaporNotu, IN_CLASS_CRITERIA); const distributedPerformance = distributeScores(performansOdeviRaporNotu, PERFORMANCE_TASK_CRITERIA); htmlContent += `<div class="pdf-page-break" style="padding: 20mm; box-sizing: border-box; width: 210mm; height: 297mm;"><div style="text-align: center; margin-bottom: 10mm;"><h1 style="font-size: 18px; font-weight: bold; margin: 0;">${settings.schoolName || 'OKUL ADI'}</h1><h2 style="font-size: 16px; margin: 5px 0;">Öğrenci Detay Raporu</h2></div><p style="font-size: 12px; margin-bottom: 10mm;"><b>Öğrenci:</b> ${student.name}</p><h3 style="font-size: 14px; font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 2mm; margin-bottom: 5mm;">Ders İçi Gözlem Formu (Toplam: ${dersIciRaporNotu})</h3><table style="width: 100%; border-collapse: collapse; font-size: 10px; margin-bottom: 10mm;"><thead><tr style="background-color: #f2f2f2;"><th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Kriter</th><th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Maks. Puan</th><th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Alınan Puan</th></tr></thead><tbody>${Object.entries(IN_CLASS_CRITERIA).map(([key, { label, max }]) => `<tr><td style="border: 1px solid #ddd; padding: 8px;">${label}</td><td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${max}</td><td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${distributedInClass[key]}</td></tr>`).join('')}</tbody></table><h3 style="font-size: 14px; font-weight: bold; border-bottom: 1px solid #ccc; padding-bottom: 2mm; margin-bottom: 5mm;">Performans Ödevi Formu (Toplam: ${performansOdeviRaporNotu})</h3><table style="width: 100%; border-collapse: collapse; font-size: 10px;"><thead><tr style="background-color: #f2f2f2;"><th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Kriter</th><th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Maks. Puan</th><th style="border: 1px solid #ddd; padding: 8px; text-align: center;">Alınan Puan</th></tr></thead><tbody>${Object.entries(PERFORMANCE_TASK_CRITERIA).map(([key, { label, max }]) => `<tr><td style="border: 1px solid #ddd; padding: 8px;">${label}</td><td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${max}</td><td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${distributedPerformance[key]}</td></tr>`).join('')}</tbody></table></div>`; });
                reportContainer.innerHTML = htmlContent; document.body.appendChild(reportContainer); const pages = Array.from(reportContainer.children); const { jsPDF } = window.jspdf; const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' }); const processPage = (index) => { if (index >= pages.length) { pdf.save(`${activeClass.name} - Detaylı Performans Raporu.pdf`); document.body.removeChild(reportContainer); setIsGeneratingPdf(false); return; } window.html2canvas(pages[index], { scale: 2, useCORS: true }).then(pageCanvas => { if (index > 0) pdf.addPage(); const imgData = pageCanvas.toDataURL('image/png'); const pdfWidth = pdf.internal.pageSize.getWidth(); const pdfHeight = pdf.internal.pageSize.getHeight(); pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST'); processPage(index + 1); }).catch(err => { console.error("PDF Sayfa oluşturma hatası:", err); document.body.removeChild(reportContainer); setIsGeneratingPdf(false); }); }; processPage(0);
            };
            
            const handleGeneratePlusMinusReport = () => {
                if (!activeClass) return;
                setIsGeneratingPdf(true);
                
                const students = activeClass.students;
                const studentsPerPage = 28; // Bir A4 sayfasına sığacak yaklaşık öğrenci sayısı
                const numPages = Math.ceil(students.length / studentsPerPage);

                const reportContainer = document.createElement('div');
                reportContainer.style.position = 'absolute';
                reportContainer.style.left = '-9999px';
                reportContainer.style.width = '210mm';
                reportContainer.style.backgroundColor = 'white';
                reportContainer.style.fontFamily = 'sans-serif';
                reportContainer.style.color = 'black';

                let htmlContent = '';

                for (let i = 0; i < numPages; i++) {
                    const studentChunk = students.slice(i * studentsPerPage, (i + 1) * studentsPerPage);
                    
                    const studentRows = studentChunk.map((student, index) => {
                        const globalIndex = i * studentsPerPage + index + 1;
                        return `<tr>
                            <td style="border: 1px solid #eee; padding: 8px;">${globalIndex}</td>
                            <td style="border: 1px solid #eee; padding: 8px;">${student.name}</td>
                            <td style="border: 1px solid #eee; text-align: center;">${student.scores.inClassPlus}</td>
                            <td style="border: 1px solid #eee; text-align: center;">${student.scores.inClassMinus}</td>
                            <td style="border: 1px solid #eee; text-align: center;">${student.scores.homeworkPlus}</td>
                            <td style="border: 1px solid #eee; text-align: center;">${student.scores.homeworkMinus}</td>
                        </tr>`;
                    }).join('');

                    htmlContent += `
                        <div class="pdf-page-break" style="display: flex; flex-direction: column; justify-content: space-between; box-sizing: border-box; width: 210mm; height: 297mm; padding: 20mm; ${i > 0 ? '' : 'page-break-after: auto;'}">
                            <div>
                                <div style="text-align: center;">
                                    <h1 style="font-size: 24px;">${settings.schoolName || 'OKUL ADI'}</h1>
                                    <h2 style="font-size: 18px;">${activeClass.name} Sınıfı Artı/Eksi Raporu (Sayfa ${i + 1}/${numPages})</h2>
                                </div>
                                <table style="width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 20px;">
                                    <thead>
                                        <tr style="border-bottom: 2px solid #333;">
                                            <th style="text-align: left; padding: 8px;">No.</th>
                                            <th style="text-align: left; padding: 8px;">Öğrenci Adı</th>
                                            <th style="text-align: center;">Sınıf İçi +</th>
                                            <th style="text-align: center;">Sınıf İçi -</th>
                                            <th style="text-align: center;">Ödev +</th>
                                            <th style="text-align: center;">Ödev -</th>
                                        </tr>
                                    </thead>
                                    <tbody>${studentRows}</tbody>
                                </table>
                            </div>
                            <div style="text-align: right; font-size: 12px; margin-top: 20mm;">
                                <p style="font-weight: bold;">${settings.teacherName || 'Öğretmen Adı'}</p>
                                <p>${settings.branchName || 'Branş'}</p>
              Sınıf               </div>
                        </div>`;
                }
                
                reportContainer.innerHTML = htmlContent;
                document.body.appendChild(reportContainer);

                const pages = Array.from(reportContainer.children);
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({ orientation: 'portrait', unit: 'mm', format: 'a4' });

                const processPage = (index) => {
                    if (index >= pages.length) {
                        pdf.save(`${activeClass.name} - Artı Eksi Raporu.pdf`);
                        document.body.removeChild(reportContainer);
                        setIsGeneratingPdf(false);
                        return;
                    }
                    window.html2canvas(pages[index], { scale: 2, useCORS: true }).then(pageCanvas => {
                        if (index > 0) pdf.addPage();
                        const imgData = pageCanvas.toDataURL('image/png');
                        const pdfWidth = pdf.internal.pageSize.getWidth();
                        const pdfHeight = pdf.internal.pageSize.getHeight();
                        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight, undefined, 'FAST');
                        processPage(index + 1);
                    }).catch(err => {
                         console.error("PDF Sayfa oluşturma hatası:", err);
                         document.body.removeChild(reportContainer);
                         setIsGeneratingPdf(false);
                    });
                };
                processPage(0);
            };

            // EKSİK FONKSİYONLAR İÇİN YER TUTUCULAR
            // Bu fonksiyonlar "Performans Notları" ve "Konuşma Sınavı" sekmelerinde çağrılıyor ama tanımlanmamış.
            // Şimdilik hata vermemeleri için boş olarak ekliyorum.

            const handleGenerateSpeakingExamReport = () => {
                if (!activeClass) return;
                alert('Konuşma Sınavı (standart) raporu henüz uygulanmadı.');
                // Buraya 9. sınıf raporuna benzer bir mantık kurabilirsiniz.
            };

            const handleGenerateSemesterReport = (semester) => {
                if (!tempClassData) return;
                alert(`${semester}. Dönem Performans Raporu henüz uygulanmadı.`);
                // Buraya ilgili dönemin raporunu basacak kod gelecek.
            };

            const handleGenerateBookReport = (semester) => {
                if (!tempClassData) return;
                alert(`${semester}. Dönem Kitap Raporu henüz uygulanmadı.`);
                // Buraya kitap sınavı raporunu basacak kod gelecek.
            };
